From: Lee Duncan <lduncan@suse.com>
Date: Wed Apr 19 10:05:42 PDT 2017
Subject: kABI: protect struct iscsi_conn
References: bsc#103470
Patch-mainline: Never, kabi

Protect the structure iscsi_conn's new spinlock
field with __GENKSYMS__. This value is added at
the end of the structure, and the structure is
only allocated by iscsi_create_conn(), and only
consumed by a handful of iSCSI/IB drivers.

Signed-off-by: Lee Duncan <lduncan@suse.com>
---
 include/scsi/libiscsi.h |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/include/scsi/libiscsi.h
+++ b/include/scsi/libiscsi.h
@@ -196,7 +196,6 @@ struct iscsi_conn {
 	struct iscsi_task	*task;		/* xmit task in progress */
 
 	/* xmit */
-	spinlock_t		taskqueuelock;  /* protects the next three lists */
 	struct list_head	mgmtqueue;	/* mgmt (control) xmit queue */
 	struct list_head	cmdqueue;	/* data-path cmd queue */
 	struct list_head	requeue;	/* tasks needing another run */
@@ -252,6 +251,9 @@ struct iscsi_conn {
 	/* custom statistics */
 	uint32_t		eh_abort_cnt;
 	uint32_t		fmr_unalign_cnt;
+#ifndef	__GENKSYMS__
+	spinlock_t		taskqueuelock;	/* protects the next three lists */
+#endif
 };
 
 struct iscsi_pool {

