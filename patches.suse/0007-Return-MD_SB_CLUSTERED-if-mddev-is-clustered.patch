From: Goldwyn Rodrigues <rgoldwyn@suse.com>
Date: Wed, 26 Nov 2014 12:22:03 -0600
Subject: [PATCH 07/57] Return MD_SB_CLUSTERED if mddev is clustered
Git-commit: ca8895d9bb41e743271c42a4438a296de891b73b
Git-commit: 9bd359203210efeb5d8f0d81c155079f34b47449
Patch-mainline: v4.1
References: fate#316335

Signed-off-by: Goldwyn Rodrigues <rgoldwyn@suse.com>
Acked-by: NeilBrown <neilb@suse.com>

---
 drivers/md/md.c                | 5 ++++-
 include/uapi/linux/raid/md_p.h | 1 +
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/md/md.c b/drivers/md/md.c
index 9f41885d87b0..78012d911e8b 100644
--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@ -5774,7 +5774,10 @@ static int get_array_info(struct mddev * mddev, void __user * arg)
 	if (mddev->in_sync)
 		info.state = (1<<MD_SB_CLEAN);
 	if (mddev->bitmap && mddev->bitmap_info.offset)
-		info.state = (1<<MD_SB_BITMAP_PRESENT);
+		info.state |= (1<<MD_SB_BITMAP_PRESENT);
+	if (mddev_is_clustered(mddev))
+		info.state |= (1<<MD_SB_CLUSTERED);
+
 	info.active_disks  = insync;
 	info.working_disks = working;
 	info.failed_disks  = failed;
diff --git a/include/uapi/linux/raid/md_p.h b/include/uapi/linux/raid/md_p.h
index ea47561dc3b7..a4ba53409858 100644
--- a/include/uapi/linux/raid/md_p.h
+++ b/include/uapi/linux/raid/md_p.h
@@ -105,6 +105,7 @@ typedef struct mdp_device_descriptor_s {
 #define MD_SB_CLEAN		0
 #define MD_SB_ERRORS		1
 
+#define	MD_SB_CLUSTERED		5 /* MD is clustered */
 #define	MD_SB_BITMAP_PRESENT	8 /* bitmap may be present nearby */
 
 /*
-- 
2.5.0

