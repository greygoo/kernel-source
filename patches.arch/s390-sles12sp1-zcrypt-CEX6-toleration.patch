From: Ingo Tuchscherer <ingo.tuchscherer@linux.vnet.ibm.com>
Subject: s390/zcrypt: Introduce CEX6 toleration
Patch-mainline: v4.10-rc1
Git-commit: b3e8652bcbfa04807e44708d4d0c8cdad39c9215
References: FATE#321783, LTC#147506

Summary:     zcrypt: toleration of new crypto adapter hardware with type 12
Description: This feature implements toleration of ap bus devices with
             device type 12 and treat them like CEX5S crypto adapters.

Upstream-Description:

             s390/zcrypt: Introduce CEX6 toleration

             Signed-off-by: Harald Freudenberger <freude@linux.vnet.ibm.com>
             Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>


Signed-off-by: Ingo Tuchscherer <ingo.tuchscherer@linux.vnet.ibm.com>
Acked-by: John Jolly <jjolly@suse.com>
---
 drivers/s390/crypto/ap_bus.c |    2 ++
 drivers/s390/crypto/ap_bus.h |    1 +
 2 files changed, 3 insertions(+)

--- a/drivers/s390/crypto/ap_bus.c
+++ b/drivers/s390/crypto/ap_bus.c
@@ -1512,6 +1512,8 @@ static void ap_scan_bus(struct work_stru
 			ap_dev->device_type = device_type;
 		}
 		ap_dev->raw_hwtype = device_type;
+		if (device_type == AP_DEVICE_TYPE_CEX6)
+			ap_dev->device_type = AP_DEVICE_TYPE_CEX5;
 
 		rc = ap_query_functions(qid, &device_functions);
 		if (!rc)
--- a/drivers/s390/crypto/ap_bus.h
+++ b/drivers/s390/crypto/ap_bus.h
@@ -121,6 +121,7 @@ static inline int ap_test_bit(unsigned i
 #define AP_DEVICE_TYPE_CEX3C	9
 #define AP_DEVICE_TYPE_CEX4	10
 #define AP_DEVICE_TYPE_CEX5	11
+#define AP_DEVICE_TYPE_CEX6	12
 
 /*
  * Known function facilities
