From: Michal Kubecek <mkubecek@suse.cz>
Date: Thu, 16 Mar 2017 10:21:53 +0100
Subject: l2tp: fix l2tp_ip_bind() return value on SOCK_ZAPPED bailout
Patch-mainline: v4.9-rc8
Git-commit: d5e3a190937a1e386671266202c62565741f0f1a (partial)
References: CVE-2016-10200 bsc#1028415

Signed-off-by: Michal Kubecek <mkubecek@suse.cz>

cve/linux-3.12: only small part of referenced mainline commit.

---
 net/l2tp/l2tp_ip.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/net/l2tp/l2tp_ip.c b/net/l2tp/l2tp_ip.c
index 81f317f841b4..efa95daafa01 100644
--- a/net/l2tp/l2tp_ip.c
+++ b/net/l2tp/l2tp_ip.c
@@ -265,6 +265,8 @@ static int l2tp_ip_bind(struct sock *sk, struct sockaddr *uaddr, int addr_len)
 	read_unlock_bh(&l2tp_ip_lock);
 
 	lock_sock(sk);
+
+	ret = -EINVAL;
 	if (!sock_flag(sk, SOCK_ZAPPED))
 		goto out;
 
-- 
2.12.0

